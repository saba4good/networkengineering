---
title: KT 인터넷 장애와 라우팅
date: 2021-10-15
tags: [routing, outage]
---
오늘 오전 11시 15~20분경부터 KT 인터넷 회선에 장애가 생기기 시작했고, 그 장애는 점점 더 크게 번졌다.
KT는 초반에 DDoS라고 발표했지만, 나중에는 라우팅 오류였다고 확인하였다.[1]

트래픽 과부하로 인해 DDoS로 오인했다고 하는 것을 보니, 라우팅을 잘못 설정하여 ping-pong을 치도록 한 것이 아닐까 생각해본다.
트래픽이 많은 IP대역(중요한 gateway라든가..)을 ping-pong 치게 하면 충분히 빠른 시간 안에 트래픽 과부하가 생길 수 있지 않을까 싶다.
ttl이 고작 64라고 해도(실제로는 128도 있을 거고), 짧은 시간 안에 트래픽의 상당량이 평소의 25배로 튄다고 생각하면, 적지 않은 증가율일 것 같다.

10월 4일 있었던 페이스북의 장애도 인재였다. 다만 페이스북은 자동화가 너무 잘되어 있어서 그게 문제를 키웠지만..

페이스북 엔지니어는 정기적인 downtime 중 백본의 상태를 보기 위한 명령어를 쳤는데, 그게 잘못되어 설정을 하는 명령이 되어 버렸다고 한다.
페이스북은 스위치에서 명령어를 넣을 때 그걸 소프트웨어가 검증한다고 하는데, 그 프로그램의 버그로 인해 검증이 제대로 안되었고, 그렇게 백본 전체가 다운되었다.
백본이 다운되자 백본과 통신하던 DNS 서버는 통신이 끊기자, DNS 서버의 BGP 광고를 멈췄다고 한다. (특이하게도 페이스북에서는 그렇게 하도록 설계되어 있다고 한다. 왜지?)

설상가상으로 네트웍 엔지니어들이 사용하는 소프트웨어 도구들이 DNS 서버에 의지하고 있던 것이었다![2]
(아마도 DNS 서버가 무엇을 근거로 BGP 광고를 끊는지 결정했던 사람과 네트웍 툴을 디자인한 사람이 서로 소통을 안했던 듯?)

어쨌든 네트웍 장비가 외부 개입없이 오류를 일으켜서 라우팅 오류를 내는 경우는 없다고 봐도 될 것 같다.
패킷을 버린다든가 재부팅이 된다든가 hang이 걸린다든가 할 수는 있겠지만.

[1] https://zdnet.co.kr/view/?no=20211025165808

[2] https://engineering.fb.com/2021/10/05/networking-traffic/outage-details/
