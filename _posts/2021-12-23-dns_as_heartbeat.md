---
title: DNS 시스템을 이용하여 외부와 차단된 시스템에 간단한 비콘 세우기
date: 2021-12-23
tags: [dns, security]
---
미리 말해두지만, 보안의 ㅂ도 모르기 때문에 여기서는 오늘 배운 간단한 아이디어만 서술하고자 한다.[^1]

보안 담당은 말할 것도 없고, 시스템 어드민이거나 개발을 하며 방화벽 오픈 정책을 신청해본 사람이라면, DNS를 공격자의 비콘으로 사용한다는게 얼마나 적절한지 감탄할 수 밖에 없다.

DMZ 구역에 있는 웹서버 같으면, 외부랑 통신하는 것이 어렵지 않아서 특정한 방식을 고수할 필요는 없다.
하지만 외부랑 통신이 안되도록 디자인된 구역의 기기를 감염시키는 경우를 생각해보자.
서버망 중 내부구역에 있는 서버거나 혹은 인터넷을 할 수 없는 구역에 있는 사용자 컴퓨터나 기기 같은 경우를 감염시켰다고 해보자.
이런 경우는 감염을 시켰다하더라도 공격자가 원하는 방식으로 외부랑 통신하기가 어렵기 때문에 비콘을 세운다는게 쉽지 않고, 따라서 외부에서 상황을 파악하고 어떤 명령을 내리는 것도 어렵다.

이렇게 외부와 차단된 시스템의 경우라도 DNS 통신은 허용하는 경우가 대다수인데, 그 이유는 일단 인프라가 어느 정도 사이즈가 되면 IP 통신만으로는 유지보수 가능한 내부 통신도 어렵기 때문이다.

그렇다면 어떻게 DNS 시스템을 상호 통신용으로 사용할지 생각해보자.
우선 DNS는 외부에 질의를 하는 시스템이고, 각각의 도메인 구조에 대해 질의를 받고 응답할 수 있는 개별 DNS 서버에 의해 운영된다는 점이다.
아래 그림 1.0을 보면 감염된 시스템이 DNS 질의를 통해 '나, iamcompromised가 살아있다'는 소식을 공격자에게까지 전달할 수 있다.
더군다나 공격자는 DNS 응답을 통해 각 감염자에게 사전에 약속된 코드/명령을 전달하는 것도 가능하다.
![그림 1.0](/networkengineering/docs/assets/images/DNS-beacon.png)

감염자가 직접 인터넷상의 다른 서버를 거치지 않은 상태에서도 이렇게 통신이 가능하다는 것이 이 아이디어의 핵심이다.

[^1]: [DNS Tunneling: how DNS can be (ab)used by malicious actors](https://unit42.paloaltonetworks.com/dns-tunneling-how-dns-can-be-abused-by-malicious-actors/){:target="_blank"}{:rel="noopener noreferrer"}
