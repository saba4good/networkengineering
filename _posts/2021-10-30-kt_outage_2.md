---
title: KT 인터넷 장애와 라우팅 II
date: 2021-10-30
tags: [routing, bgp, isis, outage]
---
과기정통부의 보도자료에 따르면 15일 있었던 90분간의 KT 인터넷 회선 장애를 야기한 사건의 경위는 이렇다.[1] 신규 라우터에 IS-IS 프로토콜 설정을 하고, BGP 프로토콜 설정을 하는 계획이었는데, IS-IS 프로토콜에서 빠져나오지 않은 채, BGP 설정 명령을 입력하였고, BGP 설정 명령이 그대로 IS-IS 프로토콜에서의 설정이 되어 버렸던 것이다.

KT의 회선 장애 사건에 대해 DevOps들의 의견들이 많은데, 네트웍 관리 환경은 응용서비스나 서버 관리 환경과 차이가 많이 난다는 것을 모르는 분들이 많은 것으로 보인다. 응용서비스/서버 관리하는 DevOps는 많으나 네트웍 관리하는 사람들은 적어서 그런 것도 있고, 서버가 프로그래밍 환경과 같이 커왔다면, 네트워크는 거기서 많이 동떨어져서 변화가 별로 없다는 것 때문일 수도 있겠다.

KT 장애에 대해 테스트베드 부재의 얘기가 있는데, 신규 장비를 들일 때 테스트환경을 만들고 설정 검증을 안했을리는 없다. 사건의 경위로 미루어 추측컨데, 이건 설정을 테스트를 해봤느냐의 문제는 아니다. (신규 장비 설치를 할 때, 어떤 문제가 있느냐에 따라 설정 순서는 변경될 수 있기 때문에 모든 대응 시나리오를 테스트하는 건 애초에 불가능하다.)

오히려 여기서 도움이 될만한 세가지는 제3자의 사전검증과 사후검증, 그리고 자동검증시스템이다.

보도자료에는 사전검증을 사람이 하면 도움이 안되는 것처럼 얘기했지만, 그건 사실이 아니다. 문제는 사람이 '안한다'는 것이지, 검토를 하는 사람이 있다면 검증 단계에서 오류가 발견되는 경우가 꽤 있다. 다만, 사람이 실제로 검토를 하도록 조직에서 검토를 업무로 인정을 해줘야 하는데, 검토를 업무로 보지 않는 환경에서 당연히 검토가 제대로 이뤄질 리 없다.

두번째는 사후검증이다. 사전검증도 필요하지만, 사후검증만 잘해도 큰 장애가 오래가지 않을 수 있다. 검증하는 명령어도 계획서에 넣어서 사후검증 자체를 검토하는 것도 한 방법이다. 이 사건의 경우에도, BGP와 IS-IS 라우팅 프로토콜을 건드렸다면, 설정 이후 각 테이블에 라우팅 경로가 제대로 들어가있는지 확인할 필요가 있다. 그리고 설정 자체도 작업자의 의도대로 들어갔는지라도 검토했다면 장애가 그렇게 오래가지 않았을 것이다. 물론 이게 바쁘면 잘 안될 수도 있기는 하지만, 꼭 필요한 부분이기도 하다.

마지막은 자동검증시스템인데, 이 시스템의 부재는 DevOps나 프로그래머들이 잘 이해하지 못하는 네트워크의 환경과도 연관이 있다. 서버 시스템은 자동화가 이뤄지는 쪽으로 방향을 틀게 된지 꽤 되었는데, 그렇게 될 수 있었던 가장 큰 이유는 서버가 어플라이언스처럼 작동하지 않고 어드민이 원하는데로 유틸/프로그램을 만들거나 깔 수 있었기 때문이다. 그에 반해 네트웍 장비는 어플라이언스처럼 작동을 해서 장비 자체에서 자동화 프로그램을 돌리기도 어려웠고, 서버만큼 여러대의 장비를 같은 방식으로 변경(반복작업)하는 경우도 별로 없어서 자동화의 필요성이 없었던 것 같기도 하다.

다행히 이제 네트웍에도 자동화라는 변화가 시작 중이어서 페이스북처럼[2] 한국 기업들의 네트웍에도 자동검증시스템이 적용될 날도 멀지 않았을 것 같다.

[1] {% link https://www.msit.go.kr/bbs/view.do?sCode=user&mId=113&mPid=112&pageIndex=&bbsSeqNo=94&nttSeqNo=3180886&searchOpt=ALL&searchTxt= %}

[2] {% link https://engineering.fb.com/2021/10/05/networking-traffic/outage-details/ %}
